---
import { teamMembers } from "../data/teamMembers";
---
<div class="w-full relative py-16 px-4">
  <div class="relative max-w-6xl mx-auto mb-110 pb-20">

    <img 
      src="src/assets/team/new_set/board.svg" 
      class="absolute -left-125 -top-50 w-auto h-auto z-10" 
    />
    
    <img 
      src="src/assets/team/new_set/film_reel_circle.svg" 
      class="absolute -right-100 -top-40 w-auto h-auto z-10 scale-90" 
    />
    
    <img 
      src="src/assets/team/new_set/film_reel.svg" 
      class="absolute left-1/2 transform -translate-x-1/2 w-full h-auto scale-165 opacity-60" 
    />
    
    <div class="text-center pt-12 relative z-20">
      <h2 class="text-6xl font-bold text-gold mb-2">Meet the Team</h2>
    </div>
  </div>

  <div class="max-w-6xl mx-auto my-16 relative z-30">
    <div class="relative">
      <img 
        src="src/assets/team/new_set/film_reel_large.svg" 
        class="w-full h-auto scale-165 left-1/2" 
      />
      
      <div id="teamPhotoContainer" class="absolute inset-0 flex items-center justify-center p-8 hidden">
        <img 
          id="teamPhoto" 
          src="teams/default_team.JPG" 
          class="w-full h-full object-contain scale-150 grayscale"
        />
      </div>
      
      <div id="memberContainer" class="absolute inset-0">
        <button id="prevBtn" class="absolute -left-86 top-1/2 -translate-y-1/2 text-white text-7xl hover:text-yellow-400 transition z-50 drop-shadow-lg">
          â€¹
        </button>
        
        <div class="absolute top-1/2 -translate-y-1/2 -left-20 flex flex-col items-center">
          <div class="relative transform">
            <img 
              id="teamPhoto" 
              src="" 
              class="w-180 h-120 object-cover rounded-lg shadow-2xl grayscale"
            />
          </div>
        </div>
        
        <div class="absolute top-1/2 -translate-y-1/2 right-20 flex flex-col gap-4 w-64">
          <div class="-rotate-6 transform transition-transform hover:rotate-0">
            <img 
              id="memberPhoto" 
              src="" 
              class="w-48 h-48 object-cover"
            />
            <div class="absolute -top-2 right-10 text-5xl">
              ðŸ“Ž
            </div>
          </div>

          <div class="flex flex-col gap-3 mt-12">
            <h3 id="memberName" class="text-4xl font-bold text-gold drop-shadow-lg text-left">
            </h3>
            <p id="memberTitle" class="text-xl text-white text-left drop-shadow-lg font-bold mt-4">
            </p>
          </div>
        </div>
        
        <button id="nextBtn" class="absolute -right-86 top-1/2 -translate-y-1/2 text-white text-7xl hover:text-yellow-400 transition z-50 drop-shadow-lg">
          â€º
        </button>
      </div>
      
      <div id="pagination" class="absolute -bottom-15 left-1/2 transform -translate-x-1/2 flex justify-center gap-2 z-20">
      </div>
    </div>
  </div>

  <div class="flex flex-wrap justify-center gap-12 mt-50">

    <button class="team-filter px-6 py-2 rounded-full border-2 border-white text-white hover:bg-white hover:text-black transition" data-team="Director">
      ðŸŽ¬ Directors
    </button>
    <button class="team-filter px-6 py-2 rounded-full border-2 border-white text-white hover:bg-white hover:text-black transition" data-team="Logistics">
      ðŸ“° Logistics
    </button>
    <button class="team-filter px-6 py-2 rounded-full border-2 border-white text-white hover:bg-white hover:text-black transition" data-team="Experience">
      ðŸ“£ Experience
    </button>
    <button class="team-filter px-6 py-2 rounded-full border-2 border-white text-white hover:bg-white hover:text-black transition" data-team="Web Development">
      ðŸ’» Web Dev
    </button>
    <button class="team-filter px-6 py-2 rounded-full border-2 border-white text-white hover:bg-white hover:text-black transition" data-team="Communications">
      ðŸ“ž Communications
    </button>
    <button class="team-filter px-6 py-2 rounded-full border-2 border-white text-white hover:bg-white hover:text-black transition" data-team="Outreach">
      ðŸ’¬ Outreach
    </button>
  </div>
</div>

<script define:vars={{ teamMembers }}>
  let currentIndex = 0;
  let filteredMembers = [...teamMembers];
  let showingDefaultPhoto = true; // Track if showing default team photo
  
  function updateDisplay() {
    const paginationDiv = document.getElementById('pagination');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    // Show default team photo initially
    if (showingDefaultPhoto) {
      document.getElementById('teamPhotoContainer').classList.remove('hidden');
      document.getElementById('memberContainer').classList.add('hidden');
      paginationDiv.classList.add('hidden');
    } else {
      document.getElementById('teamPhotoContainer').classList.add('hidden');
      document.getElementById('memberContainer').classList.remove('hidden');
      paginationDiv.classList.remove('hidden'); // Show pagination for members
      
      const member = filteredMembers[currentIndex];
      
      // Update member info card
      document.getElementById('memberName').textContent = member.name;
      document.getElementById('memberTitle').textContent = `${member.year} | ${member.major}`;
      document.getElementById('memberPhoto').src = member.image || '/placeholder-avatar.jpg';
      
      // Team photo mapping - simplified with renamed files
      const teamPhotoMap = {
        'Director': '/teams/director.JPG',
        'Logistics': '/teams/logistics.JPG',
        'Experience': '/teams/experience.JPG',
        'Web Development': '/teams/web_dev.JPG',
        'Communications': '/teams/communications.JPG',
        'Outreach': '/teams/outreach.JPG'
      };
      
      // Find team and set photo
      const teamPhotoElement = document.querySelector('#memberContainer #teamPhoto');
      for (const [teamName, photoPath] of Object.entries(teamPhotoMap)) {
        if (member.title.includes(teamName)) {
          teamPhotoElement.src = photoPath;
          break;
        }
      }
      
      // Enable/disable arrows based on position
      if (currentIndex === 0) {
        prevBtn.disabled = true;
        prevBtn.classList.add('opacity-30');
        prevBtn.classList.remove('hover:text-yellow-400');
      } else {
        prevBtn.disabled = false;
        prevBtn.classList.remove('opacity-30');
        prevBtn.classList.add('hover:text-yellow-400');
      }
      
      if (currentIndex === filteredMembers.length - 1) {
        nextBtn.disabled = true;
        nextBtn.classList.add('opacity-30');
        nextBtn.classList.remove('hover:text-yellow-400');
      } else {
        nextBtn.disabled = false;
        nextBtn.classList.remove('opacity-30');
        nextBtn.classList.add('hover:text-yellow-400');
      }
    }
    
    // Update pagination dots (only for team members, not team photo)
    paginationDiv.innerHTML = '';
    
    // Add dots for each member only
    filteredMembers.forEach((_, index) => {
      const dot = document.createElement('span');
      dot.className = `w-3 h-3 rounded-full ${index === currentIndex ? 'bg-white' : 'bg-gray-500'} cursor-pointer`;
      dot.addEventListener('click', () => {
        currentIndex = index;
        updateDisplay();
      });
      paginationDiv.appendChild(dot);
    });
  }
  
  function filterTeam(team) {
    showingDefaultPhoto = false; // Hide default photo when filter is chosen
    filteredMembers = teamMembers.filter(member => 
      member.title.includes(team)
    );
    currentIndex = 0;
    updateDisplay();
  }
  
  // Navigation buttons
  document.getElementById('prevBtn').addEventListener('click', () => {
    if (!document.getElementById('prevBtn').disabled) {
      currentIndex = currentIndex - 1;
      updateDisplay();
    }
  });
  
  document.getElementById('nextBtn').addEventListener('click', () => {
    if (!document.getElementById('nextBtn').disabled) {
      currentIndex = currentIndex + 1;
      updateDisplay();
    }
  });
  
  // Team filter buttons
  document.querySelectorAll('.team-filter').forEach(btn => {
    btn.addEventListener('click', (e) => {
      // Remove active state from all buttons
      document.querySelectorAll('.team-filter').forEach(b => {
        b.classList.remove('bg-white', 'text-black');
        b.classList.add('text-white');
      });
      // Add active state to clicked button
      e.target.classList.remove('text-white');
      e.target.classList.add('bg-white', 'text-black');
      
      const team = e.target.dataset.team;
      filterTeam(team);
    });
  });
  
  // Initialize display
  updateDisplay();
</script>