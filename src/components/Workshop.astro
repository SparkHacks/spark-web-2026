---
import lamp from "../assets/lamp.svg";
import lampSpotlight from "../assets/lampSpotlight.svg";
import Poster from "../components/workshop/Poster.astro";
import WorkshopEvent from "../components/workshop/WorkshopEvent.astro";

const posterBackgrounds = [
  "conic-gradient(from -45.87deg at 50% 50%, #A43D3D 0deg, #3E1717 360deg)",
  "conic-gradient(from 180deg at 50% 50%, #598651 -225.46deg, #152013 134.53deg, #598651 134.54deg, #152013 494.53deg)",
  "conic-gradient(from 180deg at 50% 50%, #4063A8 -224.89deg, #192742 135.07deg, #4063A8 135.11deg, #192742 495.07deg)"
];
---
<div class="bg-[#48090a] text-white pb-4">
  <div class="w-screen relative overflow-hidden min-h-[620px] py-8 md:h-[620px]">
    <h1 class="text-2xl md:text-4xl text-center pb-2">Premiering</h1>
    <h1 class="text-2xl md:text-4xl font-bold text-center mb-8 md:mb-16">Exclusive Workshops</h1>
    
    <!-- Left Lamp + Spotlight - Hidden on mobile -->
    <div
      id="lampGroupLeft"
      class="hidden md:block absolute top-0 left-1/2 transform -translate-x-120 w-[400px] h-[600px] origin-[40px_40px] transition-all duration-700 ease-out pointer-events-none opacity-0"
      style="transform: rotate(0deg);"
    >
      <img src={lamp.src} alt="lamp" class="absolute top-0 left-0 w-20 h-20 z-10" />
      <img src={lampSpotlight.src} alt="spotlight beam" class="absolute top-[60px] left-[-30px] w-[400px] blur-md" />
    </div>
    
    <!-- Right Lamp + Spotlight - Hidden on mobile -->
    <div
      id="lampGroupRight"
      class="hidden md:block absolute top-0 right-1/2 transform translate-x-120 w-[400px] h-[600px] origin-[360px_40px] transition-all duration-700 ease-out pointer-events-none opacity-0"
      style="transform: rotate(0deg);"
    >
      <img src={lamp.src} alt="lamp" class="absolute top-0 right-0 w-20 h-20 z-10 -scale-x-100" />
      <img src={lampSpotlight.src} alt="spotlight beam" class="absolute top-[60px] right-[-30px] w-[400px] -scale-x-100 blur-md" />
    </div>
    
    <!-- Posters -->
    <div id="posterRow" class="flex flex-col md:flex-row justify-center items-center gap-4 md:gap-8 px-4 md:px-0 mb-16">
      {posterBackgrounds.map((bg, index) => (
        <Poster background={bg} index={index} />
      ))}
    </div>
  </div>
  
  <div class="w-full flex justify-center px-4 md:px-0">
    <div class="w-full max-w-[280px] md:max-w-[900px] md:w-[900px] flex flex-col gap-16">
      <WorkshopEvent
        title="Test"
        date="July 20, 2024"
        time="3:00 PM"
        description="Join us for an exclusive workshop where you'll learn the secrets of mastering your craft. This hands-on session is designed for enthusiasts of all levels, providing practical skills and insights to elevate your abilities. Don't miss this opportunity to connect with like-minded individuals and take your passion to the next level!"
        link="#"
      />
      <WorkshopEvent
        title="Test"
        date="July 20, 2024"
        time="3:00 PM"
        description="Join us for an exclusive workshop where you'll learn the secrets of mastering your craft. This hands-on session is designed for enthusiasts of all levels, providing practical skills and insights to elevate your abilities. Don't miss this opportunity to connect with like-minded individuals and take your passion to the next level!"
        link="#"
      />
      <WorkshopEvent
        title="Test"
        date="July 20, 2024"
        time="3:00 PM"
        description="Join us for an exclusive workshop where you'll learn the secrets of mastering your craft. This hands-on session is designed for enthusiasts of all levels, providing practical skills and insights to elevate your abilities. Don't miss this opportunity to connect with like-minded individuals and take your passion to the next level!"
        link="#"
      />
    </div>
  </div>
</div>

<script>
  const lampGroupLeft = document.getElementById("lampGroupLeft");
  const lampGroupRight = document.getElementById("lampGroupRight");
  const posterRow = document.getElementById("posterRow");
  const posters = document.querySelectorAll(".poster");
  
  const anglesLeft = [0, -15, -25];
  const anglesRight = [25, 15, 0];
  
  let lampsActive = false;
  
  if (!lampGroupLeft || !lampGroupRight || !posterRow || posters.length === 0) {
    console.error("Lamp group, poster row, or posters not found");
  } else {
    // Intersection Observer for lamps
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            lampsActive = true;
            lampGroupLeft.style.opacity = "1";
            lampGroupRight.style.opacity = "1";
            lampGroupLeft.style.transform = "rotate(-15deg)";
            lampGroupRight.style.transform = "rotate(15deg)";
          } else {
            lampsActive = false;
            lampGroupLeft.style.opacity = "0";
            lampGroupRight.style.opacity = "0";
            lampGroupLeft.style.transform = "rotate(25deg)";
            lampGroupRight.style.transform = "rotate(-25deg)";
          }
        });
      },
      { threshold: 0.3 }
    );
    
    observer.observe(posterRow);
    
    // Poster click handlers
    posters.forEach((poster, i) => {
      poster.addEventListener("click", () => {
        posters.forEach(p => p.classList.remove("poster-active"));
        
        poster.classList.add("poster-active");
        
        if (lampsActive) {
          lampGroupLeft.style.transform = `rotate(${anglesLeft[i]}deg)`;
          lampGroupRight.style.transform = `rotate(${anglesRight[i]}deg)`;
        }
      });
    });
  }
</script>

<style is:global>
  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 5px rgba(255, 199, 126, 0.5);
    }
    50% {
      box-shadow: 0 0 15px rgba(255, 199, 126, 0.8), 0 0 25px rgba(255, 199, 126, 0.5);
    }
  }
  
  .poster-active .bulb {
    box-shadow: 0 0 10px rgba(255, 199, 126, 0.8), 0 0 20px rgba(255, 199, 126, 0.6), 0 0 30px rgba(255, 199, 126, 0.4) !important;
    animation: pulse-glow 2s ease-in-out infinite !important;
  }
</style>