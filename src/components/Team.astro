---
import { teamMembers } from "../data/teamMembers";

import Board from '../assets/team/new_set/board.svg?url';
import FilmCircle from '../assets/team/new_set/film_reel_circle.svg?url';
import FilmReel from '../assets/team/new_set/film_reel.svg?url';
---
<div id="team" class="w-full relative md:pt-10 lg:pt-20 xl:pt-30 overflow-x-hidden bg-linear-to-b from-[#1A2766] to-[#1A2766]">
  <div class="relative w-full sm:mb-4 sm:pb-8 lg:mb-32 lg:pb-25">
    <div class="relative w-full flex justify-center items-center min-h-[25vh] md:min-h-[300px] mt-10">
      
      <img 
        src={Board}
        class="absolute -left-12 top-1/2 -translate-y-1/2 w-[50vw] md:w-[25vw] max-w-[750px] md:max-w-[500px] h-auto z-10" 
      />
      
      <img 
        src={FilmCircle} 
        class="absolute -right-4 md:-right-12 top-1/2 -translate-y-1/2 w-[30vw] md:w-[24vw] max-w-[350px] h-auto z-10" 
      />

      <img 
        src={FilmReel} 
        class="absolute left-1/2 transform -translate-x-1/2 w-full h-auto scale-300 sm:scale-105 md:scale-105 opacity-70"
      />
      
      <div class="relative z-20 text-center py-8 max-w-7xl mx-auto px-50 md:px-0 lg:px-0">
        <h2 class="text-3xl md:text-5xl lg:text-7xl font-bold text-gold">Meet the Team</h2>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto my-16 md:my-32 lg:mg-32 relative z-30">
    <div class="relative">
      <img 
        src="teams/film_reel_large.svg" 
        class="w-full h-auto scale-x-150 scale-y-160 sm:scale-y-130 md:scale-x-200 md:scale-y-135 xl:scale-x-260 xl:scale-y-165 left-1/2" 
      />

      <!-- class="w-full h-auto scale-165 left-1/2" -->
      
      <div id="memberContainer" class="absolute inset-0">
        <button id="prevBtn" class="absolute left-2 md:left-0 lg:left-2 xl:-left-35 2xl:-left-70 top-1/2 -translate-y-1/2 text-white text-4xl md:text-5xl lg:text-7xl hover:text-yellow-400 transition z-50 drop-shadow-lg hover:cursor-pointer">
          â€¹
        </button>
        
        <div class="absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-[120%] sm:left-20 md:left-10 lg:-left-20 sm:translate-x-0 flex flex-col items-center">
          <div class="relative transform">
            <img 
              id="teamPhoto" 
              src="" 
              class="w-36 h-48 sm:w-90 sm:h-70 md:w-150 md:h-90 lg:w-180 lg:h-120 object-cover rounded-lg shadow-2xl grayscale"
            />
          </div>
        </div>
        
        <div class="absolute top-1/2 -translate-y-1/2 right-1/2 translate-x-[120%] sm:right-40 md:right-20 sm:translate-x-0 flex flex-col md:gap-4 w-40 md:w-64">
          <div class="relative w-fit">
            <div class="-rotate-6 transform transition-transform hover:rotate-0">
              <a id="memberLink" href="" target="_blank">
                <img 
                  id="memberPhoto" 
                  src="" 
                  class="relative w-16 h-16 sm:w-32 sm:h-32 md:w-48 md:h-48 object-cover z-10"
                />
                <!-- <span class="absolute -top-4 md:-top-2 -right-3 md:right-0 w-[150%] h-[150%] md:w-full md:h-full animate-pulse rounded-full bg-vanilla blur-xl md:blur-3xl opacity-75 z-0" /> -->
              </a>
            </div>
            <div class="absolute -top-4 right-0 sm:right-0 text-3xl md:text-5xl z-20 pointer-events-none">
              ðŸ“Ž
            </div>
          </div>

          <div class="flex flex-col gap-2 md:gap-3 md:mt-12">
            <h3 id="memberName" class="text-l sm:text-xl md:text-4xl font-bold text-gold drop-shadow-lg text-left lg:whitespace-nowrap">
            </h3>
            <p id="memberInfo" class="text-sm md:text-xl text-white text-left drop-shadow-lg font-bold mt-0 md:mt-4 md:whitespace-nowrap">
            </p>
            <p id="memberTitle" class="text-sm md:text-xl text-white text-left drop-shadow-lg font-bold mt-0 md:mt-4">
            </p>
          </div>
        </div>
        
        <button id="nextBtn" class="absolute right-2 md:right-0 lg:right-2 xl:-right-35 2xl:-right-70 top-1/2 -translate-y-1/2 text-white text-4xl md:text-5xl lg:text-7xl hover:text-yellow-400 transition z-50 drop-shadow-lg hover:cursor-pointer">
          â€º
        </button>
      </div>
      
      <div id="pagination" class="absolute -bottom-6 lg:-bottom-15 left-1/2 transform -translate-x-1/2 flex justify-center gap-2 z-20">
      </div>
    </div>
  </div>

  <div class="flex flex-wrap justify-center gap-4 lg:gap-12 mt-32 md:mt-40 lg:mt-50 max-w-lg lg:max-w-none mx-auto mb-8">

    <button class="team-filter px-4 py-2 lg:px-6 text-sm lg:text-base rounded-full border-2 border-white bg-white text-black hover:bg-white hover:text-black hover:cursor-pointer transition" data-team="Director">
      ðŸŽ¬ Directors
    </button>
    <button class="team-filter px-4 py-2 lg:px-6 text-sm lg:text-base rounded-full border-2 border-white text-white hover:bg-white hover:text-black hover:cursor-pointer transition" data-team="Logistics">
      ðŸ“° Logistics
    </button>
    <button class="team-filter px-4 py-2 lg:px-6 text-sm lg:text-base rounded-full border-2 border-white text-white hover:bg-white hover:text-black hover:cursor-pointer transition" data-team="Experience">
      ðŸ“£ Experience
    </button>
    <button class="team-filter px-4 py-2 lg:px-6 text-sm lg:text-base rounded-full border-2 border-white text-white hover:bg-white hover:text-black hover:cursor-pointer transition" data-team="Web Development">
      ðŸ’» Web Dev
    </button>
    <button class="team-filter px-4 py-2 lg:px-6 text-sm lg:text-base rounded-full border-2 border-white text-white hover:bg-white hover:text-black hover:cursor-pointer transition" data-team="Communications">
      ðŸ“ž Communications
    </button>
    <button class="team-filter px-4 py-2 lg:px-6 text-sm lg:text-base rounded-full border-2 border-white text-white hover:bg-white hover:text-black hover:cursor-pointer transition" data-team="Outreach">
      ðŸ’¬ Outreach
    </button>
  </div>
</div>

<script define:vars={{ teamMembers }}>
  let currentIndex = 0;
  let teamIndex = 0;
  let filteredMembers = teamMembers.filter(member => member.title.includes('Director'));
  let teamBtns = document.querySelectorAll('.team-filter');
  
  function updateDisplay() {
    const paginationDiv = document.getElementById('pagination');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    const member = filteredMembers[currentIndex];
    
    document.getElementById('memberName').textContent = member.name;
    document.getElementById('memberInfo').textContent = `${member.year} | ${member.major}`;
    document.getElementById('memberTitle').textContent = member.title;
    document.getElementById('memberPhoto').src = member.image;
    document.getElementById('memberLink').href = member.linkedin;
    
    const teamPhotoMap = {
      'Director': '/teams/director.JPG',
      'Logistics': '/teams/logistics.JPG',
      'Experience': '/teams/experience.JPG',
      'Web Development': '/teams/web_dev.JPG',
      'Communications': '/teams/communications.JPG',
      'Outreach': '/teams/outreach.JPG'
    };
    
    const teamPhotoElement = document.querySelector('#memberContainer #teamPhoto');
    for (const [teamName, photoPath] of Object.entries(teamPhotoMap)) {
      if (member.title.includes(teamName)) {
        teamPhotoElement.src = photoPath;
        break;
      }
    }
    
    if (currentIndex === 0) {
      prevBtn.disabled = true;
      prevBtn.classList.add('opacity-30');
      prevBtn.classList.remove('hover:text-yellow-400');
    } else {
      prevBtn.disabled = false;
      prevBtn.classList.remove('opacity-30');
      prevBtn.classList.add('hover:text-yellow-400');
    }
    
    if (currentIndex === filteredMembers.length - 1) {
      nextBtn.disabled = true;
      nextBtn.classList.add('opacity-30');
      nextBtn.classList.remove('hover:text-yellow-400');
    } else {
      nextBtn.disabled = false;
      nextBtn.classList.remove('opacity-30');
      nextBtn.classList.add('hover:text-yellow-400');
    }
    
    paginationDiv.innerHTML = '';
    
    filteredMembers.forEach((member, index) => {
      const dot = document.createElement('span');
      dot.className = `w-3 h-3 rounded-full ${index === currentIndex ? 'bg-white text-black' : 'bg-gray-500'} cursor-pointer`;
      if (window.matchMedia("(width >= 48rem)").matches) { // lg and up, show full name
        dot.className += ' h-fit w-fit text-sm px-2 whitespace-nowrap';
        dot.innerHTML = member.name;
      } else if (window.matchMedia("(width >= 26rem)").matches) { // sm and up, show first name only
        dot.className += ' h-fit w-fit text-sm px-2 whitespace-nowrap';
        dot.innerHTML = member.name.split(' ')[0];
      } // else screen is really small, keep it as dot only

      dot.addEventListener('click', () => {
        clearInterval(autoScroll);
        currentIndex = index;
        updateDisplay();
      });
      paginationDiv.appendChild(dot);
    });
  }
  
  function filterTeam(team) {
    filteredMembers = teamMembers.filter(member => 
      member.title.includes(team)
    );
    currentIndex = 0;
    updateDisplay();
  }
  
  document.getElementById('prevBtn').addEventListener('click', () => {
    if (!document.getElementById('prevBtn').disabled) {
      clearInterval(autoScroll);
      currentIndex = currentIndex - 1;
      updateDisplay();
    }
  });
  
  document.getElementById('nextBtn').addEventListener('click', () => {
    if (!document.getElementById('nextBtn').disabled) {
      clearInterval(autoScroll);
      currentIndex = currentIndex + 1;
      updateDisplay();
    }
  });

  let autoScroll = setInterval(() => {
    if (!document.getElementById('nextBtn').disabled) {
      currentIndex = currentIndex + 1;
    } else {
      teamIndex = (teamIndex + 1) % teamBtns.length;

      teamBtns.forEach(b => {
        b.classList.remove('bg-white', 'text-black');
        b.classList.add('text-white');
      });

      teamBtns[teamIndex].classList.remove('text-white');
      teamBtns[teamIndex].classList.add('bg-white', 'text-black');

      const team = teamBtns[teamIndex].dataset.team;
      filterTeam(team);
    }
    updateDisplay();
  }, 5000);
  
  teamBtns.forEach(btn => {
    btn.addEventListener('click', (e) => {
      clearInterval(autoScroll);

      teamBtns.forEach(b => {
        b.classList.remove('bg-white', 'text-black');
        b.classList.add('text-white');
      });

      e.target.classList.remove('text-white');
      e.target.classList.add('bg-white', 'text-black');
      
      const team = e.target.dataset.team;
      filterTeam(team);
    });
  });
  
  // Swipe to change member (mobile only - was vibe coded so test throughly pls)
  let touchStartX = 0;
  let touchEndX = 0;
  const memberContainer = document.getElementById('memberContainer');
  
  memberContainer.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
  });
  
  memberContainer.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  });
  
  function handleSwipe() {
    const swipeThreshold = 50;
    
    if (touchEndX < touchStartX - swipeThreshold) {
      if (!document.getElementById('nextBtn').disabled) {
        clearInterval(autoScroll);
        currentIndex = currentIndex + 1;
        updateDisplay();
      }
    }
    
    if (touchEndX > touchStartX + swipeThreshold) {
      if (!document.getElementById('prevBtn').disabled) {
        clearInterval(autoScroll);
        currentIndex = currentIndex - 1;
        updateDisplay();
      }
    }
  }
  
  updateDisplay();
</script>
